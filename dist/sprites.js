(()=>{function t(t){return new Promise((e=>setTimeout(e,t)))}class e{constructor(t,e,i){this.imgSrc=t,this.width=e,this.height=i,this.sx=0,this.sy=0,this.dx=0,this.dy=0,this.image=new Image,this.image.src=t,this.animating=!1}render(t){this.animating&&null!=this.animating&&this.nextFrame(),t.getContext("2d").drawImage(this.image,this.sx,this.sy,this.width,this.height,this.dx,this.dy,this.width,this.height)}setAnimation(t,e=null,i=!0){this.animation=t,e&&(this.animation.onComplete=e),this.animating=i}nextFrame(){let t=this.animation.nextFrame();this.sx=t.x,this.sy=t.y}}class i{constructor(t){this.xStart=t.xStart,this.yOffset=t.yOffset,this.nextSpriteX=t.nextSpriteX,this.xEnd=t.xEnd,this.fpsBuffer=t.fpsBuffer,this.buffer=0,this.x=t.xStart,this.y=t.yLine,this.onComplete=t.onComplete}nextFrame(){let t={x:this.x,y:this.yOffset};return this.buffer<=this.fpsBuffer?(this.buffer++,t):(this.x+=this.nextSpriteX,(this.xEnd<0&&this.x<=this.xEnd||this.x>=this.xEnd)&&this.reset(),this.buffer=0,t)}reset(){this.x=this.xStart,this.onComplete&&this.onComplete()}}class s{constructor(){this.sprite=new e(browser.extension.getURL("sprites/explosion-edit.png"),165,165)}render(t){this.sprite.animation&&(this.sprite.nextFrame(),this.sprite.render(t))}async explode(){this.sprite.setAnimation(new i({xStart:0,xEnd:990,nextSpriteX:165,yOffset:0,fpsBuffer:3,onComplete:()=>{this.sprite.setAnimation(null)}}))}}function n(t){t.style.cursor="pointer",t.removeAttribute("onclick"),"A"==t.parentElement.nodeName&&(t.parentElement.removeAttribute("onclick"),t.addEventListener("click",(t=>(t.preventDefault(),t.stopPropagation(),!1)))),t.addEventListener("click",(e=>{e.preventDefault();let i=t.getBoundingClientRect();a.sprite.dx=i.left-.1*i.top,a.sprite.dy=i.top-.1*i.top,a.bonk();let n=new s;r.addSprite(n),n.sprite.dx=i.left+100,n.sprite.dy=i.top,n.explode().then(setTimeout((()=>{t.remove(),"A"==t.parentElement.nodeName&&t.parentElement.remove()}),200))}))}var r=new class{constructor(t=[]){this.canvas=document.createElement("canvas"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.canvas.id="randomly-generated-i-guess",this.canvas.style.position="fixed",this.canvas.style.top=0,this.canvas.style.right=0,this.canvas.style.bottom=0,this.canvas.style.left=0,this.canvas.style.zIndex=9e3,this.canvas.style.pointerEvents="none",this.sprites=t}addSprite(t){this.sprites.push(t)}attach(t){t?t.appendChild(this.canvas):console.error("given element was null")}render(){this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.sprites.forEach((t=>{t.render(this.canvas)}))}async loop(){for(;;)this.render(),await t(25)}get(){return this.canvas}clear(){this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height)}};let a=new class{constructor(){this.sprite=new e(browser.extension.getURL("sprites/cheems.png"),205,137),this.animations={idle:new i({xStart:0,xEnd:205,nextSpriteX:0,yOffset:0,fpsBuffer:7}),bonk:new i({xStart:205,xEnd:411,nextSpriteX:205,yOffset:0,fpsBuffer:2,onComplete:()=>{this.sprite.animating=!1}})},this.sprite.setAnimation(this.animations.idle)}render(t){this.sprite.animation&&this.sprite.render(t)}bonk(){new Audio(browser.extension.getURL("sounds/bonk.ogg")).play(),this.sprite.setAnimation(this.animations.bonk,(()=>{this.sprite.setAnimation(null)}))}};r.addSprite(a);var o=new class{constructor(){this.sprite=new e(browser.extension.getURL("sprites/jotaro_new.png"),97,97),this.animations={idle:new i({xStart:873,xEnd:1358,nextSpriteX:97,yOffset:0,fpsBuffer:7}),run:new i({xStart:0,xEnd:776,nextSpriteX:97,yOffset:0,fpsBuffer:1}),punch1:new i({xStart:1455,xEnd:1649,nextSpriteX:97,yOffset:0,fpsBuffer:2,onComplete:()=>{this.idle()}})},this.sprite.setAnimation(this.animations.idle)}render(t){this.sprite.animation&&this.sprite.render(t)}run(){this.sprite.setAnimation(this.animations.run)}idle(){this.sprite.setAnimation(this.animations.idle)}punch(t=null){this.sprite.setAnimation(this.animations.punch1,t)}async bonkImage(e){new Audio(browser.extension.getURL("sounds/yareyaredaze.ogg")).play(),await t(25),this.run();let i=e.getBoundingClientRect(),n=i.left-this.sprite.dx-.1*i.left;for(let e=0;e<n;e+=10)this.sprite.dx=e,await t(25);this.punch((()=>{}));var a=new Audio(browser.extension.getURL("sounds/ORA.ogg"));a.addEventListener("ended",(()=>{let t=new s;r.addSprite(t),t.sprite.dx=i.left,t.sprite.dy=i.top,t.explode().then((()=>{new Audio(browser.extension.getURL("sounds/bonk.ogg")).play(),this.idle(),e.remove()}))})),a.play()}};r.addSprite(o),window.addEventListener("load",(t=>{console.log("やれやれだぜ。"),document.getElementById("cat");for(let t=0;t<document.images.length;t++)n(document.images[t]);["div","body","td"].forEach((t=>{let e=document.getElementsByTagName(t);for(let t=0;t<e.length;t++){let i=e[t];i.style.background.match("url")&&n(i),i.style.backgroundImage.match("url")&&n(i)}})),r.attach(document.body),r.loop(),o.idle(),n(document.getElementById("cat"))}))})();