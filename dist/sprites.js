(()=>{function t(t){return new Promise((s=>setTimeout(s,t)))}class s{constructor(t,s){this.imgSrc=t,this.dimensions=s,this.sx=0,this.sy=0,this.dx=0,this.dy=0,this.image=new Image,this.image.src=t,this.animating=!1}render(t){this.animating&&null!=this.animating&&this.nextFrame(),t.getContext("2d").drawImage(this.image,this.sx,this.sy,this.dimensions.width,this.dimensions.height,this.dx,this.dy,this.dimensions.width,this.dimensions.height)}setAnimation(t,s=!0){this.animation=t,this.animating=s}nextFrame(){let t=this.animation.nextFrame();this.sx=t.x,this.sy=t.y}}class i{constructor(t){this.xStart=t.xStart,this.yOffset=t.yOffset,this.nextSpriteX=t.nextSpriteX,this.xEnd=t.xEnd,this.fpsBuffer=t.fpsBuffer,this.buffer=0,this.x=t.xStart,this.y=t.yLine,this.onComplete=t.onComplete}nextFrame(){let t={x:this.x,y:this.yOffset};return this.buffer<=this.fpsBuffer?(this.buffer++,t):(this.x+=this.nextSpriteX,(this.xEnd<0&&this.x<=this.xEnd||this.x>=this.xEnd)&&this.reset(),this.buffer=0,t)}reset(){this.x=this.xStart,this.onComplete&&this.onComplete()}}var e,n=new class{constructor(t=[]){this.canvas=document.createElement("canvas"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.canvas.id="randomly-generated-i-guess",this.canvas.style.position="fixed",this.canvas.style.top=0,this.canvas.style.right=0,this.canvas.style.bottom=0,this.canvas.style.left=0,this.canvas.style.zIndex=9e3,this.canvas.style.pointerEvents="none",this.sprites=t}addSprite(t){this.sprites.push(t)}attach(t){t?t.appendChild(this.canvas):console.error("given element was null")}render(){this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.sprites.forEach((t=>{t.render(this.canvas)}))}async loop(){for(;;)this.render(),await t(25)}get(){return this.canvas}clear(){this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height)}},a=new class{constructor(){this.sprite=new s("../dist/sprites/jotaro_new.png",{width:97,height:97}),this.animations={idle:new i({xStart:873,xEnd:1358,nextSpriteX:97,yOffset:0,fpsBuffer:7}),run:new i({xStart:0,xEnd:776,nextSpriteX:97,yOffset:0,fpsBuffer:1}),punch1:new i({xStart:1455,xEnd:1649,nextSpriteX:97,yOffset:0,fpsBuffer:2,onComplete:()=>{this.idle()}})},this.sprite.setAnimation(this.animations.idle)}render(t){this.sprite.animation&&this.sprite.render(t)}run(){this.sprite.setAnimation(this.animations.run)}idle(){this.sprite.setAnimation(this.animations.idle)}punch(){this.sprite.setAnimation(this.animations.punch1)}async bonkImage(s){this.run();let i=s.x-this.sprite.dx-.1*s.x;for(let s=0;s<i;s+=10)this.sprite.dx=s,await t(25);this.punch(),await t(100),s.style.backgroundImage=new URL(s.src),s.style.boxShadow="inset 0 0 99999px rgba(0, 120, 255, 0.5);"}},h=new class{constructor(){this.sprite=new s("../dist/sprites/explosion-edit.png",{width:165,height:165})}render(t){this.sprite.animation&&(this.sprite.nextFrame(),this.sprite.render(t))}explode(){this.sprite.setAnimation(new i({xStart:0,xEnd:990,nextSpriteX:165,yOffset:0,fpsBuffer:3,onComplete:()=>{this.sprite.setAnimation(null)}}))}};n.addSprite(a),n.addSprite(h),document.addEventListener("DOMContentLoaded",(function(){var t;console.log("やれやれだぜ。"),console.log(e),e=document.getElementById("cat"),n.attach(document.body),n.loop(),a.idle(),(t=e=document.getElementById("cat")).style.cursor="pointer",t.addEventListener("click",(t=>{h.sprite.dx=t.x-h.sprite.dimensions.width/2,h.sprite.dy=t.y-h.sprite.dimensions.height/2,h.explode(),new Audio("../dist/sounds/bonk.ogg").play()})),console.log(e),a.bonkImage(e)}))})();